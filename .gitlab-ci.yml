image: docker

services:
- docker:dind

before_script:
- docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD

stages:
- test
- comportamento
- build-push-docker

test:
  image: node:16
  stage: test
  script:
  - npm install
  - npm run tdd

comportamento:
  image: cypress/browsers
  stage: comportamento
  dependencies:
  - test
  script:
  - npm install
  - nohup npm start &
  - npm run bdd

build-push-docker:
  stage: build-push-docker
  dependencies:
  - comportamento
  script:
  - docker build -t didox/app-nodejs-desafio-k8s .
  - docker push didox/app-nodejs-desafio-k8s





